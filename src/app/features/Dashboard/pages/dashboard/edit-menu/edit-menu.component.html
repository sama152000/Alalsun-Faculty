<div class="edit-menu-container" dir="ltr">
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1 class="page-title">Edit Menu</h1>
        <p class="page-description">Modify the settings for the selected menu</p>
      </div>
      <div class="header-actions">
        <button pButton type="button" class="p-button-text p-button-secondary" [routerLink]="['/dashboard/menus']">
          <i class="pi pi-arrow-left"></i>
          <span>Back to Menus</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-container text-center">
    <div class="loading-spinner">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem;"></i>
      <p>Loading data...</p>
    </div>
  </div>

  <form [formGroup]="menuForm" (ngSubmit)="updateMenu()" class="menu-form" *ngIf="!isLoading">
    <!-- Toast Notifications -->
    <p-toast position="top-right"></p-toast>

    <!-- Basic Information -->
    <div class="form-section card shadow-sm">
      <div class="section-header card-header">
        <h2>Basic Information</h2>
        <p>Edit the basic details of the menu</p>
      </div>
      
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="name" class="form-label">Menu Name *</label>
            <input 
              id="name"
              type="text" 
              class="form-control" 
              [class.is-invalid]="isFieldInvalid('name')"
              formControlName="name"
              placeholder="e.g., Main Menu 2025"
            >
            <div class="invalid-feedback" *ngIf="isFieldInvalid('name')">
              {{ getFieldError('name') }}
            </div>
          </div>

          <div class="col-md-3">
            <label for="type" class="form-label">Menu Type *</label>
            <select 
              id="type"
              class="form-select" 
              [class.is-invalid]="isFieldInvalid('type')"
              formControlName="type"
            >
              <option value="" disabled>Select Menu Type</option>
              <option value="header">Header</option>
              <option value="footer">Footer</option>
            </select>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('type')">
              {{ getFieldError('type') }}
            </div>
          </div>

          <div class="col-md-3" *ngIf="menuForm.get('type')?.value === 'header'">
            <label for="headerType" class="form-label">Header Type *</label>
            <select 
              id="headerType"
              class="form-select" 
              [class.is-invalid]="isFieldInvalid('headerType')"
              formControlName="headerType"
            >
              <option value="" disabled>Select Header Type</option>
              <option value="top_nav">Top Navigation</option>
              <option value="main_nav">Main Navigation</option>
              <option value="submenu">Submenu</option>
            </select>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('headerType')">
              {{ getFieldError('headerType') }}
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-check mt-4">
              <input 
                id="isActive"
                type="checkbox" 
                class="form-check-input"
                formControlName="isActive"
              >
              <label for="isActive" class="form-check-label">Activate Menu</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Faculty Information (Top Navigation) -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'top_nav'">
      <div class="section-header card-header">
        <h2>Faculty Information</h2>
        <p>Edit faculty details for top navigation</p>
      </div>
      
      <div class="card-body" formGroupName="facultyInfo">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="facultyName" class="form-label">Faculty Name</label>
            <input 
              id="facultyName"
              type="text" 
              class="form-control" 
              formControlName="name"
              placeholder="Faculty of Al-Alsun"
            >
          </div>
          <div class="col-md-6">
            <label for="subtitle" class="form-label">Subtitle</label>
            <input 
              id="subtitle"
              type="text" 
              class="form-control" 
              formControlName="subtitle"
              placeholder="Luxor University"
            >
          </div>
          <div class="col-md-6">
            <label for="universityName" class="form-label">University Name</label>
            <input 
              id="universityName"
              type="text" 
              class="form-control" 
              formControlName="universityName"
              placeholder="Luxor University"
            >
          </div>
          <div class="col-md-6">
            <label for="established" class="form-label">Established Year</label>
            <input 
              id="established"
              type="text" 
              class="form-control" 
              formControlName="established"
              placeholder="2019"
            >
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Items (Main Navigation) -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'main_nav'">
      <div class="section-header card-header">
        <h2>Navigation Items</h2>
        <p>Edit main and sub-navigation items</p>
        <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addNavbarItem()">
          <i class="pi pi-plus"></i>
          <span>Add Navigation Item</span>
        </button>
      </div>
      
      <div class="card-body" formArrayName="navbarItems">
        <div *ngFor="let item of navbarItemsArray.controls; let i = index" [formGroupName]="i" class="item-card card mb-3">
          <div class="item-header card-header d-flex justify-content-between align-items-center">
            <div class="item-info">
              <h3 class="h5 mb-0">Navigation Item {{ i + 1 }}</h3>
              <span class="item-type text-muted">Main Item</span>
            </div>
            <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeNavbarItem(i)">
              <i class="pi pi-trash"></i>
            </button>
          </div>
          
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Display Text *</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="label"
                  placeholder="e.g., Home, About"
                >
              </div>
              <div class="col-md-4">
                <label class="form-label">Route</label>
                <input 
                  type="text" 
                  class="form-control" 
                  formControlName="route"
                  placeholder="e.g., /home, /about"
                >
              </div>
              <div class="col-md-4">
                <label class="form-label">Link Target</label>
                <select class="form-select" formControlName="target">
                  <option value="">Same Window</option>
                  <option value="_blank">New Window</option>
                  <option value="_self">Same Frame</option>
                  <option value="_parent">Parent Frame</option>
                </select>
              </div>
            </div>

            <!-- Children Items -->
            <div class="children-section mt-4">
              <div class="section-header d-flex justify-content-between align-items-center">
                <h4>Sub-Items</h4>
                <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addNavbarChild(i)">
                  <i class="pi pi-plus"></i>
                  <span>Add Sub-Item</span>
                </button>
              </div>
              
              <div formArrayName="children" class="children-container">
                <div *ngFor="let child of getNavbarChildrenArray(i).controls; let j = index" [formGroupName]="j" class="child-item card mb-2">
                  <div class="item-header card-header d-flex justify-content-between align-items-center">
                    <div class="item-info">
                      <h5 class="mb-0">Sub-Item {{ j + 1 }}</h5>
                      <span class="item-type text-muted">Sub-Item</span>
                    </div>
                    <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeNavbarChild(i, j)">
                      <i class="pi pi-times"></i>
                    </button>
                  </div>
                  <div class="card-body">
                    <div class="row g-3">
                      <div class="col-md-4">
                        <label class="form-label">Display Text *</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          formControlName="label"
                          placeholder="e.g., Education Sector"
                        >
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">Route</label>
                        <input 
                          type="text" 
                          class="form-control" 
                          formControlName="route"
                          placeholder="e.g., /sectors/education"
                        >
                      </div>
                      <div class="col-md-4">
                        <label class="form-label">Link Target</label>
                        <select class="form-select" formControlName="target">
                          <option value="">Same Window</option>
                          <option value="_blank">New Window</option>
                          <option value="_self">Same Frame</option>
                          <option value="_parent">Parent Frame</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submenu Configuration -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'header' && menuForm.get('headerType')?.value === 'submenu'">
      <div class="section-header card-header">
        <h2>Submenu Settings</h2>
        <p>Edit submenu settings and contact information</p>
      </div>
      
      <div class="card-body" formGroupName="submenu">
        <div class="row g-3">
          <div class="col-12">
            <label for="copyright" class="form-label">Copyright Text</label>
            <input 
              id="copyright"
              type="text" 
              class="form-control" 
              formControlName="copyright"
              placeholder="© 2025 Faculty of Al-Alsun. All rights reserved."
            >
          </div>
        </div>
        
        <h3 class="mt-4">Contact Methods</h3>
        <div formGroupName="contactMethods" class="row g-3">
          <div class="col-md-4">
            <label for="phone" class="form-label">Phone</label>
            <input 
              id="phone"
              type="tel" 
              class="form-control" 
              formControlName="phone"
              placeholder="+20 95 237 1000"
            >
          </div>
          <div class="col-md-4">
            <label for="email" class="form-label">Email</label>
            <input 
              id="email"
              type="email" 
              class="form-control" 
              formControlName="email"
              placeholder="info@alsun.luxor.edu.eg"
            >
          </div>
          <div class="col-md-4">
            <label for="universityWebsite" class="form-label">University Website</label>
            <input 
              id="universityWebsite"
              type="url" 
              class="form-control" 
              formControlName="universityWebsite"
              placeholder="https://luxor.edu.eg"
            >
          </div>
        </div>

        <!-- Languages -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>Available Languages</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addSubmenuLanguage()">
              <i class="pi pi-plus"></i>
              <span>Add Language</span>
            </button>
          </div>
          <div formArrayName="languages" class="languages-container">
            <div *ngFor="let lang of submenuLanguagesArray.controls; let i = index" [formGroupName]="i" class="language-item card mb-2">
              <div class="item-header card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Language {{ i + 1 }}</h4>
                <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeSubmenuLanguage(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Code *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="value"
                      placeholder="e.g., en"
                    >
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Name *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="label"
                      placeholder="e.g., English"
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Configuration -->
    <div class="form-section card shadow-sm" *ngIf="menuForm.get('type')?.value === 'footer'">
      <div class="section-header card-header">
        <h2>Footer Settings</h2>
        <p>Edit footer settings and social media links</p>
      </div>
      
      <div class="card-body" formGroupName="footerData">
        <!-- Basic Footer Info -->
        <div class="subsection">
          <h3>Basic Information</h3>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="footerTitle" class="form-label">Title</label>
              <input 
                id="footerTitle"
                type="text" 
                class="form-control" 
                formControlName="title"
                placeholder="Faculty of Al-Alsun"
              >
            </div>
            <div class="col-md-6">
              <label for="footerSubtitle" class="form-label">Subtitle</label>
              <input 
                id="footerSubtitle"
                type="text" 
                class="form-control" 
                formControlName="subtitle"
                placeholder="Luxor University"
              >
            </div>
            <div class="col-md-6">
              <label for="tagline" class="form-label">Tagline</label>
              <input 
                id="tagline"
                type="text" 
                class="form-control" 
                formControlName="tagline"
                placeholder="Excellence in Language Education"
              >
            </div>
            <div class="col-md-6">
              <label for="footerCopyright" class="form-label">Copyright</label>
              <input 
                id="footerCopyright"
                type="text" 
                class="form-control" 
                formControlName="copyright"
                placeholder="© 2025 Faculty of Al-Alsun. All rights reserved."
              >
            </div>
          </div>
        </div>

        <!-- Social Media Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>Social Media Links</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterSocialLink()">
              <i class="pi pi-plus"></i>
              <span>Add Social Link</span>
            </button>
          </div>
          <div formArrayName="socialLinks" class="social-links-container">
            <div *ngFor="let link of footerSocialLinksArray.controls; let i = index" [formGroupName]="i" class="social-link-item card mb-2">
              <div class="item-header card-header d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Social Link {{ i + 1 }}</h4>
                <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterSocialLink(i)">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-3">
                    <label class="form-label">Platform *</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      formControlName="platform"
                      placeholder="e.g., Facebook"
                    >
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">URL *</label>
                    <input 
                      type="url" 
                      class="form-control" 
                      formControlName="url"
                      placeholder="e.g., https://facebook.com/page"
                    >
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Icon *</label>
                    <select class="form-select" formControlName="icon">
                      <option value="" disabled>Select Icon</option>
                      <option *ngFor="let icon of socialIcons" [value]="icon.value">
                        {{ icon.label }}
                      </option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label">Link Target</label>
                    <select class="form-select" formControlName="target">
                      <option value="">Same Window</option>
                      <option value="_blank">New Window</option>
                      <option value="_self">Same Frame</option>
                      <option value="_parent">Parent Frame</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>Quick Links</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterQuickLink()">
              <i class="pi pi-plus"></i>
              <span>Add Quick Link</span>
            </button>
          </div>
          <div formGroupName="quickLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="quickLinksTitle" class="form-label">Section Title</label>
                <input 
                  id="quickLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="Quick Links"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerQuickLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">Link {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterQuickLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">Title *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="e.g., About Faculty"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">URL *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="e.g., /about"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Link Target</label>
                      <select class="form-select" formControlName="target">
                        <option value="">Same Window</option>
                        <option value="_blank">New Window</option>
                        <option value="_self">Same Frame</option>
                        <option value="_parent">Parent Frame</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Academic Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>Academic Links</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterAcademicLink()">
              <i class="pi pi-plus"></i>
              <span>Add Academic Link</span>
            </button>
          </div>
          <div formGroupName="academicLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="academicLinksTitle" class="form-label">Section Title</label>
                <input 
                  id="academicLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="Academic Links"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerAcademicLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">Link {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterAcademicLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">Title *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="e.g., Postgraduate Studies"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">URL *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="e.g., /postgraduate"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Link Target</label>
                      <select class="form-select" formControlName="target">
                        <option value="">Same Window</option>
                        <option value="_blank">New Window</option>
                        <option value="_self">Same Frame</option>
                        <option value="_parent">Parent Frame</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Links -->
        <div class="subsection mt-4">
          <div class="section-header d-flex justify-content-between align-items-center">
            <h3>Resource Links</h3>
            <button pButton type="button" class="p-button-outlined p-button-sm" (click)="addFooterResourceLink()">
              <i class="pi pi-plus"></i>
              <span>Add Resource Link</span>
            </button>
          </div>
          <div formGroupName="resourceLinks">
            <div class="row g-3 mb-3">
              <div class="col-12">
                <label for="resourceLinksTitle" class="form-label">Section Title</label>
                <input 
                  id="resourceLinksTitle"
                  type="text" 
                  class="form-control" 
                  formControlName="title"
                  placeholder="Resources"
                >
              </div>
            </div>
            <div formArrayName="links" class="links-container">
              <div *ngFor="let link of footerResourceLinksArray.controls; let i = index" [formGroupName]="i" class="link-item card mb-2">
                <div class="item-header card-header d-flex justify-content-between align-items-center">
                  <h4 class="mb-0">Link {{ i + 1 }}</h4>
                  <button pButton type="button" class="p-button-text p-button-danger p-button-sm" (click)="removeFooterResourceLink(i)">
                    <i class="pi pi-trash"></i>
                  </button>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">Title *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="title"
                        placeholder="e.g., Library"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">URL *</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        formControlName="url"
                        placeholder="e.g., /library"
                      >
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Link Target</label>
                      <select class="form-select" formControlName="target">
                        <option value="">Same Window</option>
                        <option value="_blank">New Window</option>
                        <option value="_self">Same Frame</option>
                        <option value="_parent">Parent Frame</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions mt-4 d-flex justify-content-end gap-3">
      <button pButton type="button" class="p-button-outlined p-button-secondary" [routerLink]="['/dashboard/menus']">
        <i class="pi pi-times"></i>
        <span>Cancel</span>
      </button>
      <button pButton type="submit" class="p-button p-button-primary" [disabled]="menuForm.invalid">
        <i class="pi pi-check"></i>
        <span>Save Changes</span>
      </button>
    </div>
  </form>
</div>