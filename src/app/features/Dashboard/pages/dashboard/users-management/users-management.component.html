<div class="users-management">
  <div class="management-header">
    <h2>Users Management</h2>
    <button
      class="btn-primary-custom"
      (click)="openAddDialog()"
    >
      <i class="pi pi-plus"></i>
      Add New User
    </button>
  </div>

  <div class="users-list">
    <div class="user-card" *ngFor="let user of users">
      <div class="user-info">
        <div class="user-avatar">
          <i class="pi pi-user"></i>
        </div>
        <div class="user-details">
          <h3>{{ user.name }}</h3>
          <p class="user-email">{{ user.email }}</p>
          <div class="user-meta">
            <span class="meta-item">
              <i class="pi pi-shield"></i>
              {{ getRoleLabel(user.role) }}
            </span>
            <span class="meta-item" [class]="getStatusClass(user.status)">
              <i class="pi pi-circle-fill"></i>
              {{ user.status }}
            </span>
            <span class="meta-item" *ngIf="user.lastLogin">
              <i class="pi pi-clock"></i>
              Last login: {{ user.lastLogin | date:'short' }}
            </span>
          </div>
        </div>
      </div>
      <div class="user-actions">
        <button
          class="btn-edit"
          (click)="openEditDialog(user)"
        >
          <i class="pi pi-pencil"></i>
          Edit
        </button>
        <button
          class="btn-delete"
          (click)="confirmDelete(user.id)"
        >
          <i class="pi pi-trash"></i>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Dialog -->
  <div class="dialog-overlay" *ngIf="showDialog" [class.show]="showDialog">
    <div class="dialog" [style.maxWidth]="'600px'">
      <div class="dialog-header">
        <h3>{{ isEditing ? 'Edit User' : 'Add New User' }}</h3>
        <button type="button" class="close-button" (click)="closeDialog()">×</button>
      </div>
      <form [formGroup]="userForm" (ngSubmit)="saveUser()">
        <div class="tabs">
          <div class="tab-headers">
            <button type="button" class="tab-header" [class.active]="activeTab === 'basic'" (click)="activeTab = 'basic'">
              <i class="pi pi-info-circle"></i> Basic Info
            </button>
            <button type="button" class="tab-header" [class.active]="activeTab === 'security'" (click)="activeTab = 'security'" *ngIf="!isEditing">
              <i class="pi pi-lock"></i> Security
            </button>
          </div>
          <div class="tab-content" [class.active]="activeTab === 'basic'">
            <div class="form-grid">
              <div class="form-group">
                <label>Full Name *</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="name"
                  placeholder="Enter full name"
                >
              </div>
              <div class="form-group">
                <label>Email Address *</label>
                <input
                  type="email"
                  class="form-control"
                  formControlName="email"
                  placeholder="Enter email address"
                >
              </div>
              <div class="form-group">
                <label>Role</label>
                <select formControlName="role" class="form-control">
                  <option value="">Select role</option>
                  <option *ngFor="let role of userRoles" [value]="role.value">
                    {{ role.label }}
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label>Status</label>
                <select formControlName="status" class="form-control">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>
          </div>

          <div class="tab-content" [class.active]="activeTab === 'security'" *ngIf="!isEditing">
            <div class="form-grid">
              <div class="form-group">
                <label>Password *</label>
                <input
                  type="password"
                  class="form-control"
                  formControlName="password"
                  placeholder="Enter password"
                >
              </div>
              <div class="form-group">
                <label>Confirm Password *</label>
                <input
                  type="password"
                  class="form-control"
                  formControlName="confirmPassword"
                  placeholder="Confirm password"
                >
                <div class="error-message" *ngIf="userForm.errors?.['mismatch']">
                  Passwords do not match
                </div>
              </div>
            </div>
          </div>

          <div class="dialog-actions">
            <button
              type="button"
              class="btn-outline-primary-custom"
              (click)="closeDialog()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="btn-primary-custom"
              [disabled]="userForm.invalid"
            >
              {{ isEditing ? 'Update' : 'Create' }} User
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirmation Dialog -->
  <div class="dialog-overlay" *ngIf="showConfirmDialog" [class.show]="showConfirmDialog">
    <div class="dialog confirmation-dialog">
      <div class="dialog-header">
        <h3>Confirm Delete</h3>
        <button type="button" class="close-button" (click)="closeConfirmDialog()">×</button>
      </div>
      <div class="dialog-content">
        <p>Are you sure you want to delete this user?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      <div class="dialog-actions">
        <button
          type="button"
          class="btn-outline-primary-custom"
          (click)="closeConfirmDialog()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="btn-primary-custom"
          (click)="deleteUser()"
        >
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Messages -->
  <div class="toast-container" *ngIf="showToast">
    <div class="toast" [class]="toastClass">
      <div class="toast-content">
        <i [class]="toastIcon"></i>
        <span>{{ toastMessage }}</span>
      </div>
      <button type="button" class="toast-close" (click)="hideToast()">×</button>
    </div>
  </div>
</div>
